#!/usr/bin/env fdp
digraph make_withdraw {
        graph[splines=true]
        node[fontname=monospace, shape=plaintext]
        subgraph cluster_global {
                label="global"
                make_withdraw_global
                w1_global
                w2_global
        }
        make_withdraw[label="parameters: initial-amount\lbody: (lambda (balance)\l  (lambda (amount)\l    (if (>= balance amount)\l        (begin (set! balance (- balance amount))\l               balance)\l      \"Insufficient funds\")) initial-amount)"]
        make_withdraw_global -> make_withdraw
        make_withdraw -> cluster_global
        subgraph cluster_e1 {
                label="E1"
                e1_initial_amount[label="initial-amount: 100"]
        }
        lambda_balance[label="parameters: balance\lbody: (lambda (amount)\l  (if (>= balance amount)\l      (begin (set! balance (- balance amount))\l             balance)\l    \"Insufficient funds\"))"]
        w1_global -> lambda_balance
        lambda_balance -> cluster_e1
        cluster_e1 -> cluster_global
        lambda_amount[label="parameters: amount\lbody: (if (>= balance amount)\l    (begin (set! balance (- balance amount))\l           balance)\l  \"Insufficient funds\")"]
        cluster_e1 -> lambda_amount
        subgraph cluster_e2 {
                label="E2"
                e2_initial_amount[label="balance: 50"]
        }
        lambda_amount -> cluster_e2
        subgraph cluster_e3 {
                label="E3"
                e3_initial_amount[label="initial-amount: 100"]
        }
        w2_global -> lambda_balance
        lambda_balance -> cluster_e3
        cluster_e3 -> cluster_global
        subgraph cluster_e4 {
                label="E4"
                e4_initial_amount[label="balance: 100"]
        }
        cluster_e3 -> lambda_amount
        lambda_amount -> cluster_e4
}
