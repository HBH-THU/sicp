#!/usr/bin/env fdp
digraph make_account {
        graph[fontname=monospace, splines=true]
        node[fontname=monospace]
        subgraph cluster_global {
                label="global"
                make_account_global[label="make-account"]
                acc_global[label="acc"]
        }
        make_account[label="parameters: balance\lbody:\l(define (withdraw...\l(define (deposit...\l(define (dispatch..."]
        make_account_global -> make_account
        make_account -> cluster_global
        subgraph cluster_e1 {
                label="E1"
                e1_balance[label="balance: 90"]
                e1_withdraw[label="withdraw"]
                e1_deposit[label="deposit"]
                e1_dispatch[label="dispatch"]
        }
        cluster_e1 -> cluster_global
        withdraw[label="parameters: amount\lbody: (if (>= balance amount..."]
        deposit[label="parameters: amount\lbody: (set! balance ..."]
        dispatch[label="parameters: m\lbody: (cond ((eq? m 'withdraw..."]
        e1_withdraw -> withdraw
        e1_deposit -> deposit
        e1_dispatch -> dispatch
        withdraw -> cluster_e1
        deposit -> cluster_e1
        dispatch -> cluster_e1
        lambda_balance[label="parameters: balance\lbody:\l((lambda (balance)\l  (define (withdraw...)))\l  balance)"]
        acc_global -> lambda_balance
        lambda_balance -> cluster_e1
        subgraph cluster_e2 {
                label="E2"
                e2_m[label="m: 'withdraw"]
        }
        subgraph cluster_e3 {
                label="E3"
                e2_amount[label="amount: 60"]
        }
        cluster_e2 -> cluster_e1
        cluster_e3 -> cluster_e1
}
