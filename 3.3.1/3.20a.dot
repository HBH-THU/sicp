#!/usr/bin/env fdp
digraph make_account {
        graph[fontname=monospace, splines=true]
        node[fontname=monospace]
        subgraph cluster_global {
                label="global"
                cons_global[label="cons"]
                car_global[label="car"]
                cdr_global[label="car"]
                set_car_global[label="set-car!"]
                x_global[label=x]
                z_global[label=z]
        }
        cons[label="parms: x y\lbody:\l(define (set-x!...\l(define(set-y!\l(define (dispatch..."]
        car[label="parms: z\lbody: (z 'car)"]
        cdr[label="parms: z\lbody: (z 'cdr)"]
        set_car[label="parms: z new-value\lbody: ((z 'set-car!..."]
        subgraph cluster_e1 {
                label="E1"
                e1_x[label="x: 1"]
                e1_y[label="y: 2"]
                e1_set_x[label="set-x!"]
                e1_set_y[label="set-y!"]
                e1_dispatch[label="dispatch"]
        }
        set_x_e1[label="parms: v\lbody: (set! x v)"]
        set_y_e1[label="parms: v\lbody: (set! y v)"]
        dispatch_e1[label="parms: m\lbody: (cond ((eq? m..."]
        subgraph cluster_e2 {
                label="E2"
                e2_x[label="x: x"]
                e2_y[label="y: x"]
                e2_set_x[label="set-x!"]
                e2_set_y[label="set-y!"]
                e2_dispatch[label="dispatch"]
        }
        set_x_e2[label="parms: v\lbody: (set! x v)"]
        set_y_e2[label="parms: v\lbody: (set! y v)"]
        dispatch_e2[label="parms: m\lbody: (cond ((eq? m..."]
        subgraph cluster_e3 {
                label="E3 (cdr)"
                e3_m[label="m: 'cdr"]
        }
        subgraph cluster_e4 {
                label="E4 (set-car!)"
                e4_z[label="z: x"]
                e4_new_value[label="new-value: 17"]
        }
        cons_global -> cons
        cons -> cluster_global
        car_global -> car
        car -> cluster_global
        cdr_global -> cdr
        cdr -> cluster_global
        set_car_global -> set_car
        set_car -> cluster_global
        x_global -> cluster_e1
        cluster_e1 -> cluster_global
        e1_set_x -> set_x_e1
        set_x_e1 -> cluster_e1
        e1_set_y -> set_y_e1
        set_y_e1 -> cluster_e1
        e1_dispatch -> dispatch_e1
        dispatch_e1 -> cluster_e1
        z_global -> cluster_e2
        cluster_e2 -> cluster_global
        e2_set_x -> set_x_e2
        set_x_e2 -> cluster_e2
        e2_set_y -> set_y_e2
        set_y_e2 -> cluster_e2
        e2_dispatch -> dispatch_e2
        dispatch_e2 -> cluster_e2
        cluster_e3 -> cluster_e2
        cluster_e4 -> cluster_e2
}
